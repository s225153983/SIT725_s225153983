<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Books Catalogue</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 24px; }
      h1 { margin: 0 0 12px; }
      button { padding: 10px 14px; cursor: pointer; }
      #layout { display: grid; grid-template-columns: 1fr 1fr; gap: 18px; margin-top: 18px; }
      #listBox, #detailBox { border: 1px solid #ccc; padding: 12px; min-height: 220px; }
      #booksList { list-style: none; padding-left: 0; margin: 0; }
      #booksList li { padding: 8px; border-bottom: 1px solid #eee; cursor: pointer; }
      #booksList li:hover { background: #f6f6f6; }
      .muted { color: #555; font-size: 0.95em; }
      .label { font-weight: 700; }
      .row { margin: 6px 0; }
    </style>
  </head>
  <body>
    <h1>Books Catalogue developed by <span class="muted">s225153983</span></h1>

    <p class="muted">Click the button below to get all books from the server:</p>
    <button id="btnGetBooks">Get all books</button>

    <div id="layout">
      <div id="listBox">
        <div class="label">Books</div>
        <p class="muted">Click a book to view details.</p>
        <ul id="booksList"></ul>
      </div>

      <div id="detailBox">
        <div class="label">Book Details</div>
        <p class="muted" id="detailHint">No book selected.</p>
        <div id="details"></div>
      </div>
    </div>

    <script>
      const btn = document.getElementById("btnGetBooks");
      const listEl = document.getElementById("booksList");
      const detailsEl = document.getElementById("details");
      const detailHint = document.getElementById("detailHint");

      function money(price, currency) {
      if (price && typeof price === "object" && "$numberDecimal" in price) {
        return `${price.$numberDecimal} ${currency || "AUD"}`;
      }
      return `${price} ${currency || "AUD"}`;
    }


      function renderList(books) {
        listEl.innerHTML = "";
        detailsEl.innerHTML = "";
        detailHint.textContent = "No book selected.";

        if (!Array.isArray(books) || books.length === 0) {
          const li = document.createElement("li");
          li.textContent = "No books found.";
          li.style.cursor = "default";
          listEl.appendChild(li);
          return;
        }

        for (const b of books) {
          const li = document.createElement("li");
          li.textContent = `${b.title} ${money(b.price, b.currency)}`;
          li.addEventListener("click", () => loadBook(b.id));
          listEl.appendChild(li);
        }
      }

      function renderDetails(book) {
        detailHint.textContent = "";

        const html = `
          <div class="row"><span class="label">Title:</span> ${book.title}</div>
          <div class="row"><span class="label">Author:</span> ${book.author}</div>
          <div class="row"><span class="label">Year:</span> ${book.year}</div>
          <div class="row"><span class="label">Genre:</span> ${book.genre}</div>
          <div class="row"><span class="label">Summary:</span> ${book.summary}</div>
          <div class="row"><span class="label">Price (AUD):</span> ${money(book.price, book.currency)}</div>
        `;
        detailsEl.innerHTML = html;
      }

      async function loadBooks() {
        detailsEl.innerHTML = "";
        detailHint.textContent = "No book selected.";
        listEl.innerHTML = "<li>Loading...</li>";

        const res = await fetch("/api/books");
        if (!res.ok) {
          listEl.innerHTML = "<li>Failed to load books.</li>";
          return;
        }
        const body = await res.json();
        renderList(body.data);
      }

      async function loadBook(id) {
        detailsEl.innerHTML = "";
        detailHint.textContent = "Loading book details...";

        const res = await fetch(`/api/books/${id}`);
        if (!res.ok) {
          detailHint.textContent = "Book not found.";
          return;
        }
        const body = await res.json();
        renderDetails(body.data);
      }

      // Task says list loads via button click
      btn.addEventListener("click", loadBooks);
    </script>
  </body>
</html>
